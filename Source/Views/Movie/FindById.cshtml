@model TDP.Models.Application.MovieDTO;
@{
    ViewData["Title"] = "FindById";
}

<h1>@Html.DisplayFor(model => model.Title)</h1>

<div>
    <h4>Details</h4>
    <hr />
    <dl class="row align-content-sm-center">
        <dd class="col-sm-6">
            <dl class="row align-content-sm-center">
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Type)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Type)
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Released)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Released)
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Runtime)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Runtime) mins
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Actors)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Actors)
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Director)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Director)
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Writer)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Writer)
                </dd>
                <div class="w-100"></div>
                <dt class="col-sm-3">
                    @Html.DisplayNameFor(model => model.Plot)
                </dt>
                <dd class="col-sm-9">
                    @Html.DisplayFor(model => model.Plot)
                </dd>
            </dl>
        </dd>
        <dt class="col-sm-6 align-content-sm-center">
            <img src="@Url.Content(Model.Poster)" />
        </dt>
    </dl>

    <form id="addToWishListForm" method="post" asp-controller="Movie" asp-action="AddToWishList">
        <input type="hidden" name="movieId" value="@Model.Id" />
        <input type="hidden" name="userId" value="94CF6D33-3128-4CB2-B656-44381A59FE54" />
        <button type="button" id="addToWishListButton">Add to Watch List</button>
    </form>
    <form id="removeFromWatchListForm" method="post" asp-controller="Movie" asp-action="RemoveFromWatchlist">
        <input type="hidden" name="movieId" value="@Model.Id" />
        <input type="hidden" name="userId" value="94CF6D33-3128-4CB2-B656-44381A59FE54" />
        <button type="button" id="removeFromWatchListButton">Remove from your watchlist</button>
    </form>


    <h6 id="watchlistText">This movie is already added to your watchlist!</h6>


    <!-- Rating-->
    <form id="rateMovie" method="post" asp-controller="Movie" asp-action="RateMovie">
        <input type="hidden" name="movieId" value="@Model.Id" />
        <input type="hidden" name="userId" value="94CF6D33-3128-4CB2-B656-44381A59FE54" />

        <!-- Input for Rating -->
        <label for="rating">Rating:</label>
        <input type="number" name="rating" min="1" max="5" required />

        <!-- Input for Comment (optional) -->
        <label for="comment">Comment:</label>
        <textarea name="comment"></textarea>

        <button type="button" id="rateMovieButton">Rate Movie</button>
    </form>

    <form id="removeMovieRating" method="post" asp-controller="Movie" asp-action="RemoveMovieRating">
        <input type="hidden" name="movieId" value="@Model.Id" />
        <input type="hidden" name="userId" value="94CF6D33-3128-4CB2-B656-44381A59FE54" />

        <button type="button" id="removeMovieRatingButton">Remove Rating</button>
    </form>



</div>


<div>
    <a asp-controller="Home" asp-action="Index">Back to Home</a>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Function to check if the movie is added to the wishlist
        function checkIfAddedToWishlist() {
            $.ajax({
                url: "/Movie/AddedToWishList",
                type: "POST",
                data: {
                    movieId: "@Model.Id",
                    userId: "94CF6D33-3128-4CB2-B656-44381A59FE54"
                },
                success: function (data) {
                    // Set the result to the inWishlist variable
                    inWishlist = data;

                    // Check the condition and update the form visibility
                    updateFormVisibility();
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        }

        // Function to update the form visibility based on inWishlist
        function updateFormVisibility() {
            if (inWishlist) {
                // Movie is in the wishlist
                $("#addToWishListForm").hide();
                $("#watchlistText").show();
                $("#removeFromWatchListForm").show();
                
            } else {
                // Movie is not in the wishlist
                $("#addToWishListForm").show();
                $("#watchlistText").hide();
                $("#removeFromWatchListForm").hide();
            }
        }

        // Initial check when the page loads
        checkIfAddedToWishlist();

        // Set up the click event
        $("#addToWishListButton").click(function () {
            $.ajax({
                url: "/Movie/AddToWishList",
                type: "POST",
                data: $("#addToWishListForm").serialize(),
                success: function (data) {
                    // Update the wishlist status after adding
                    checkIfAddedToWishlist();
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });

        $("#rateMovieButton").click(function () {
            $.ajax({
                url: "/Movie/RateMovie",
                type: "POST",
                data: $("#rateMovie").serialize(),
                success: function (data) {
                    // Handle success (if needed)
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });

        $("#removeFromWatchListButton").click(function () {
            $.ajax({
                url: "/Movie/RemoveFromWatchlist",
                type: "POST",
                data: $("#removeFromWatchListForm").serialize(),
                success: function (data) {
                    // Update the wishlist status after adding
                    checkIfAddedToWishlist();
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });

        
    });
</script>
